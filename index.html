<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>E-Clip</title>

<style>
body {
  margin: 0;
  padding: 10px;
  font-family: Segoe UI, sans-serif;
  background: #1e1e1e;
  color: #d4d4d4;
  display: flex;
  flex-direction: column;
  align-items: center;
}

h1 { color: #61dafb; }

textarea {
  width: 100%;
  max-width: 1000px;
  height: 300px;
  background: #252526;
  color: #d4d4d4;
  border: 1px solid #333;
  border-radius: 5px;
  padding: 10px;
  font-family: monospace;
}

button {
  margin: 5px;
  padding: 10px 15px;
  background: #0e639c;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

button:hover { background: #1177bb; }

#link {
  width: 100%;
  max-width: 1000px;
  margin-top: 10px;
  padding: 10px;
  background: #252526;
  border: 1px solid #333;
  color: #61dafb;
}
</style>
</head>

<body>

<h1>E-Clip</h1>

<textarea id="input" placeholder="Paste text here"></textarea>

<div>
  <button onclick="generate()">Generate Link (5 min)</button>
  <button onclick="copyText()">Copy Text</button>
  <button onclick="copyLink()">Copy Link</button>
</div>

<input id="link" readonly onclick="this.select()">

<script>
const EXPIRY_MS = 5 * 60 * 1000;

function encode(data) {
  return btoa(unescape(encodeURIComponent(data)));
}

function decode(data) {
  return decodeURIComponent(escape(atob(data)));
}

function generate() {
  if (!input.value) return;

  const payload = {
    t: Date.now(),
    d: encode(input.value)
  };

  const hash = btoa(JSON.stringify(payload));
  link.value = location.origin + location.pathname + "#data=" + hash;
}

function loadFromUrl() {
  if (!location.hash.startsWith("#data=")) return;

  try {
    const raw = atob(location.hash.replace("#data=", ""));
    const payload = JSON.parse(raw);

    if (Date.now() - payload.t > EXPIRY_MS) {
      alert("❌ Link expired");
      return;
    }

    input.value = decode(payload.d);
    alert("✅ File loaded");
  } catch {
    alert("❌ Invalid or corrupted link");
  }
}

function copyText() {
  navigator.clipboard.writeText(input.value);
  alert("Copied");
}

function copyLink() {
  if (!link.value) return alert("Generate link first");
  navigator.clipboard.writeText(link.value);
  alert("Link copied");
}

loadFromUrl();
</script>

</body>
</html>
